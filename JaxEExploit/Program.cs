#region

using System;
using LeagueSharp;
using LeagueSharp.Common;

#endregion

namespace JaxEExploit
{
    internal class Program
    {
        public static Spell E;
        public static Obj_AI_Base Target;
        public static Menu Menu;
        public static float LastCast = 0;

        private static void Main(string[] args)
        {
            Menu = new Menu("Jax E Exploit", "Jax E Exploit", true);
            Menu.AddItem(new MenuItem("Key", "Key").SetValue(new KeyBind(32, KeyBindType.Press)));
            Menu.AddToMainMenu();

            E = new Spell(SpellSlot.E);
            Game.OnGameSendPacket += Game_OnGameSendPacket;
            Game.OnGameUpdate += Game_OnGameUpdate;

            Console.WriteLine("Loaded");
        }

        private static void Game_OnGameUpdate(System.EventArgs args)
        {
            if (Menu.Item("Key").GetValue<KeyBind>().Active && Target != null && !Target.IsDead && E.IsReady() &&
                Environment.TickCount - LastCast > 60)
            {
                Console.WriteLine("Cast");
                E.CastOnUnit(Target, true);
                LastCast = Environment.TickCount;
            }
        }

        private static void Game_OnGameSendPacket(GamePacketEventArgs args)
        {
            if (args.PacketData[0] != Packet.C2S.SetTarget.Header)
            {
                return;
            }

            var decoded = Packet.C2S.SetTarget.Decoded(args.PacketData);

            if (decoded.NetworkId != 0 && decoded.Unit.IsValid && !decoded.Unit.IsMe)
            {
                Console.WriteLine("Set Target: " + decoded.Unit.Name);
                Target = decoded.Unit;
            }
        }
    }
}